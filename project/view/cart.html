<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>购物车</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Favicon -->

		<!-- all css here -->
		<!-- bootstrap v3.3.6 css -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
		<!-- animate css -->
        <link rel="stylesheet" href="css/animate.css">
		<!-- meanmenu css -->
        <link rel="stylesheet" href="css/meanmenu.min.css">
		<!-- owl.carousel css -->
        <link rel="stylesheet" href="css/owl.carousel.css">
		<!-- font-awesome css -->
        <link rel="stylesheet" href="css/font-awesome.min.css">
		<!-- flexslider.css-->
        <link rel="stylesheet" href="css/flexslider.css">
		<!-- chosen.min.css-->
        <link rel="stylesheet" href="css/chosen.min.css">
		<!-- style css -->
		<link rel="stylesheet" href="css/style.css">
		<!-- responsive css -->
        <link rel="stylesheet" href="css/responsive.css">
		<!-- modernizr css -->
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    </head>
    <body class="cart">


        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
		<!-- header-area-start -->
        <header>
			<!-- header-top-area-start -->
			<div class="header-top-area">
				<div class="container">
					<div class="row">
						<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
							<div class="language-area">
								<ul>
									<li><a href="#">欢迎光临静谧时光<i class="fa"></i></a></li>
								</ul>
							</div>
						</div>
						<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
							<div class="account-area text-right">
								<ul>
									<li id="loginss"><a href="/login">登录</a></li>
									<li id="user_names">你好,<a href="javascript:;"></a>&nbsp;&nbsp;&nbsp;<a href="javascript">退出</a></li>
									<li><a href="/orders">我的订单</a></li>
									<li><a href="#">我的账户</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- header-top-area-end -->
			<!-- header-mid-area-start -->
			<div class="header-mid-area ptb-40">
				<div class="container">
					<div class="row">
						<div class="col-lg-3 col-md-3 col-sm-5 col-xs-12">
							<div class="header-search">
								<form action="#" method="get" class="searchs">
									<input type="text" class="input" name="input" placeholder="请输入你要搜索的图书" />
									<a href="javascript:;" class="search_btn"><i class="fa fa-search"></i></a>
								</form>
							</div>
						</div>
						<div class="col-lg-6 col-md-6 col-sm-4 col-xs-12">
							<div class="logo-area text-center logo-xs-mrg">
								<a href="/index"><img src="img/logo/logo3.png" alt="logo" /></a>
							</div>
						</div>
						<div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
							<div class="my-cart">
								<ul>
									<li><a href="./cart"><i class="fa fa-shopping-cart"></i>我的购物车</a>
										<!-- <span>2</span> -->
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- header-mid-area-end -->
			<!-- main-menu-area-start -->
			<div class="main-menu-area hidden-sm hidden-xs sticky-header-1" id="header-sticky">
				<div class="container">
					<div class="row">
						<div class="col-lg-12">
							<div class="menu-area">
								<nav>
									<ul>
										<li class="active"><a href="/index">首页<i class="fa"></i></a></li>
										<li><a href="#">人文社科<i class="fa"></i></a></li>
										<li><a href="#">网络文学</a></li>
										<li><a href="#">生活励志</a></li>
										<li><a href="#">童书馆</a></li>
										<li><a href="#">电子书</a></li>
									</ul>
								</nav>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- main-menu-area-end -->
			<!-- mobile-menu-area-start -->
			<div class="mobile-menu-area hidden-md hidden-lg">
				<div class="container">
					<div class="row">
						<div class="col-lg-12">
							<div class="mobile-menu">
								<nav id="mobile-menu-active">
									<ul>
										<li class="active"><a href="/index">首页<i class="fa"></i></a></li>
										<li><a href="#">人文社科<i class="fa"></i></a></li>
										<li><a href="#">网络文学</a></li>
										<li><a href="#">生活励志</a></li>
										<li><a href="#">童书馆</a></li>
										<li><a href="#">电子书</a></li>
									</ul>
								</nav>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- mobile-menu-area-end -->
		</header>
		<!-- header-area-end -->
		<!-- breadcrumbs-area-start -->
		<div class="breadcrumbs-area mb-70">
			<!-- <div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="breadcrumbs-menu">
							<ul>
								<li><a href="#">Home</a></li>
								<li><a href="#" class="active">cart</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div> -->
		</div>
		<!-- breadcrumbs-area-end -->
		<!-- entry-header-area-start -->
		<div class="entry-header-area">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="entry-header-title">
							<h2 class="sp_hots"><span class="sp_hot">全部商品</span></h2>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- entry-header-area-end -->
		<!-- cart-main-area-start -->
		<div class="cart-main-area mb-70">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<!-- <form action="#"> -->
							<div class="table-content table-responsive">
								<table>
									<thead>
										<tr>
											<th class="product-hot">
												<input class="form-check-input my_inputs" type="checkbox">
												<span class="my_span">全选</span>
											</th>
											<th class="product-name">商品信息</th>
											<th class="product-price">单价</th>
											<th class="product-quantity">数量</th>
											<th class="product-subtotal">总金额</th>
											<th class="product-remove">操作</th>
										</tr>
									</thead>
									<tbody class="gwc">
										{{#each data}}
										<tr data-index="{{id}}">
											<td class="product-hot">
												<input class="form-check-input mycheckbox" data-id="{{id}}"  type="checkbox">
											</td>
											<td class="product-name">
												<a href="/product-details/{{url}}" class="floatleft cartimg"><img src="{{imgs}}" alt="{{bookname}}" /></a>
												<a href="/product-details/{{url}}" class="geshi">{{bookname}}</a>
											</td>
											<td class="product-price"><span class="amount">¥<b class="prices">{{price}}</b></span></td>
											<td class="product-quantity">
												<button class="addsub subnum">－</button>
												<input type="text" value="{{num}}" class="my_inputs1">
												<button class="addsub addnum">＋</button>
											</td>
											<td class="product-subtotal">¥<span class="allprice">{{allprice}}</span></td>
											<td class="product-remove"><span class="delgwc" data-code="{{id}}"><i class="fa fa-times"></i></span></td>
										</tr>
										{{/each}}
										<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered" role="document">
											  <div class="modal-content" style="width: 300px; margin: 100px auto;">
												<div class="modal-header">
												  <!-- <h5 class="modal-title" id="exampleModalCenterTitle">Modal title</h5> -->
												  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span aria-hidden="true">&times;</span>
												  </button>
												</div>
												<div class="modal-body">
												  你确定要删除这个商品？
												</div>
												<div class="modal-footer">
												  <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
												  <button type="button" class="btn btn-primary determine">确定</button>
												</div>
											  </div>
											</div>
										  </div>
									</tbody>
								</table>
							</div>
						<!-- </form> -->
					</div>
				</div>
				<div class="row">
                    <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                        <!-- <div class="buttons-cart mb-30"> -->
                            <!-- <ul>
                                <li><a href="#">Update Cart</a></li>
                                <li><a href="#">Continue Shopping</a></li>
                            </ul> -->
                        <!-- </div> -->
                        <div class="coupon">
                            <h3>优惠券</h3>
                            <p>输入优惠券代码（如果有）。</p>
                            <form action="#">
                                <input type="text" placeholder="优惠券代码">
                                <a href="#">申请优惠券</a>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                        <div class="cart_totals">
                            <h2>购物车总计</h2>
                            <table>
                                <tbody>
                                    <tr class="cart-subtotal">
                                        <th>小计</th>
                                        <td>
                                            <span class="amount">¥<span class="allps">0.00</span>
                                        </td>
                                    </tr>
                                    <tr class="shipping">
                                        <th>运输</th>
                                        <td>
                                            <ul id="shipping_method">
                                                <li>
                                                    <input type="radio">
                                                    <label>
                                                        统一费用:
                                                        <span class="amount">¥7.00</span>
                                                    </label>
                                                </li>
                                                <li>
                                                    <input type="radio" checked>
                                                    <label> 免费送货 </label>
                                                </li>
                                            </ul>
                                            <a href="#">计算运费</a>
                                        </td>
                                    </tr>
                                    <tr class="order-total">
                                        <th>总</th>
                                        <td>
                                            <strong>
                                                <span class="amount">¥<span class="allps">0.00</span></span>
                                            </strong>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="wc-proceed-to-checkout">
                                <a href="#" class="settlement">结算</a>
                            </div>
                        </div>
                    </div>
                </div>
			</div>
		</div>
		<!-- cart-main-area-end -->
		<!-- footer-area-start -->
		<footer>
			<!-- footer-top-start -->
			<div class="footer-top">
				<div class="container">
					<div class="row">
						<div class="col-lg-12">
							<div class="footer-top-menu bb-2">
								<nav>
									<ul>
										<li><a href="#">网站简介</a></li>
										<li><a href="#">启用Cookies</a></li>
										<li><a href="#">隐私和Cookie政策</a></li>
										<li><a href="#"> 联系我们</a></li>
										<li><a href="#">博客</a></li>
									</ul>
								</nav>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- footer-top-start -->
			<!-- footer-mid-start -->
			<div class="footer-mid ptb-50">
				<div class="container">
					<div class="row">
				        <div class="col-lg-8 col-md-8 col-sm-12">
				            <div class="row">
				                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                                    <div class="single-footer br-2 xs-mb">
                                        <div class="footer-title mb-20">
                                            <h3>购物指南</h3>
                                        </div>
                                        <div class="footer-mid-menu">
                                            <ul>
                                                <li><a href="about.html">购物流程</a></li>
                                                <li><a href="#">发票制度</a></li>
                                                <li><a href="#">服务协议</a></li>
                                                <li><a href="#">会员优惠</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
				                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                                    <div class="single-footer br-2 xs-mb">
                                        <div class="footer-title mb-20">
                                            <h3>支付方式</h3>
                                        </div>
                                        <div class="footer-mid-menu">
                                            <ul>
                                                <li><a href="about.html">微信支付</a></li>
                                                <li><a href="#">网上支付</a></li>
                                                <li><a href="#">货到付款</a></li>
                                                <li><a href="#">银行卡支付</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                                    <div class="single-footer br-2 xs-mb">
                                        <div class="footer-title mb-20">
                                            <h3>售后服务</h3>
                                        </div>
                                        <div class="footer-mid-menu">
                                            <ul>
                                                <li><a href="contact.html">退换货流程</a></li>
                                                <li><a href="#">投诉与建议</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                                    <div class="single-footer br-2 xs-mb">
                                        <div class="footer-title mb-20">
                                            <h3>我的账户</h3>
                                        </div>
                                        <div class="footer-mid-menu">
                                            <ul>
                                                <li><a href="contact.html">地址</a></li>
                                                <li><a href="#">信用单 </a></li>
                                                <li><a href="#">订单</a></li>
                                                <li><a href="#">个人信息</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
				            </div>
				        </div>
				        <div class="col-lg-3 col-md-3  col-sm-12">
                            <div class="single-footer mrg-sm">
                                <div class="footer-title mb-20">
                                    <h3>其他信息</h3>
                                </div>
                                <div class="footer-contact">
                                    <p class="adress">
                                        <span>本站简介</span>
									</p>
									<p>联系我们</p>
                                    <p>友情链接</p>
                                    <p>加入我们</p>
                                </div>
                            </div>
				        </div>
					</div>
				</div>
			</div>
			<!-- footer-mid-end -->
			<!-- footer-bottom-start -->
			<div class="footer-bottom">
				<div class="container">
					<div class="row bt-2">
						<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
							<div class="copy-right-area">
								<p>版权所有 ©<a href="http://www.bootstrapmb.com/">莫柏圣</a>. 保留所有权利.</p>
							</div>
						</div>
						<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
							<!-- <div class="payment-img text-right">
								<a href="#"><img src="img/1.png" alt="payment" /></a>
							</div> -->
						</div>
					</div>
				</div>
			</div>
			<!-- footer-bottom-end -->
		</footer>
		<!-- footer-area-end -->
		
		
		<!-- all js here -->
		<!-- jquery latest version -->
        <script src="js/vendor/jquery-1.12.0.min.js"></script>
		<!-- bootstrap js -->
        <script src="js/bootstrap.min.js"></script>
		<!-- owl.carousel js -->
        <script src="js/owl.carousel.min.js"></script>
		<!-- meanmenu js -->
        <script src="js/jquery.meanmenu.js"></script>
		<!-- wow js -->
        <script src="js/wow.min.js"></script>
		<!-- jquery.parallax-1.1.3.js -->
        <script src="js/jquery.parallax-1.1.3.js"></script>
		<!-- jquery.countdown.min.js -->
        <script src="js/jquery.countdown.min.js"></script>
		<!-- jquery.flexslider.js -->
        <script src="js/jquery.flexslider.js"></script>
		<!-- chosen.jquery.min.js -->
        <script src="js/chosen.jquery.min.js"></script>
		<!-- jquery.counterup.min.js -->
        <script src="js/jquery.counterup.min.js"></script>
		<!-- waypoints.min.js -->
        <script src="js/waypoints.min.js"></script>
		<!-- plugins js -->
        <script src="js/plugins.js"></script>
		<!-- main js -->
		<script src="js/main.js"></script>
		<script src="js/checklogin.js"></script>
		<script>
			$('.gwc tr').each(function(i){
				$(this).attr('code',i);
			})
			$(function(){
				//点击全选
				$('.my_inputs').click(function(){
					if($(this).is(':checked')){
						//全选
						var num = 0;
						$('.mycheckbox').each(function(i){
							$(this).prop('checked','false');
							var code = $('.allprice').eq(i).html();
							num = num + Number(code);
						});
						$('.allps').html(num.toFixed(2));
					}else{
						//全不选
						var num = 0;
						$('.mycheckbox').each(function(){
							$(this).prop('checked',!$(this).prop('checked'));
						});
						$('.allps').html(num.toFixed(2));
					}
				})
				//点击复选框
				
				$('.mycheckbox').click(function(i){
					var length = $('.mycheckbox').length;
					// var index = $(this).attr('data-id');
					// console.log($(this).parent().parent().children().eq(4).children().html());
					var code1 = $(this).parent().parent().attr('code');
					// console.log(index);
					var code = 0;
					var num = $('.allps').html();
					var price = $(this).parent().parent().children().eq(4).children().html();
					if(!$(this).is(':checked')){
						$('.my_inputs').prop('checked',!$('.my_inputs').prop('checked'));
						var num1 = Number(num) - Number(price);
						$('.allps').html(num1.toFixed(2))
					}else{
						var num2 = Number(num) + Number(price);
						$('.allps').html(num2.toFixed(2));
					}
					$('.mycheckbox').each(function(i){
						if($(this).is(':checked')){
							code = code + 1;
						}
					})
					console.log(length);
					console.log(code);
					if(length == code && code !=0){
						$('.my_inputs').prop('checked',!$('.my_inputs').prop('checked'));
					}
				})
				//加减商品
				$('.addnum').on('click',function(){
					var code = $(this).parent().parent().attr('code');
					var num = $(this).prev().val();
					$(this).prev().val(num*1+1);
					var price = $('.prices').eq(code).html();
					var sum = (num*1+1)*Number(price);
					var allprice = $('.allprice').eq(code).html(sum.toFixed(2));
					if($('.mycheckbox').eq(code).is(':checked')){
						var allps = $('.allps').html();
						var sum1 =  Number(allps)+Number(price);
						$('.allps').html(sum1.toFixed(2));
					}
					var book = {};
					book.id = $(this).parent().parent().attr('data-index');
					book.num = $(this).prev().val();
					book.allprice = sum;
					$.ajax({
						type:'get',
						url:'updategwc',
						data:'book='+JSON.stringify(book),
						dataType:'json',
						success:function(data){

						}
					})
				})
				$('.subnum').on('click',function(){
					var code = $(this).parent().parent().attr('code');
					if($(this).next().val() == 1){
						$(this).next().val(1);
					}else{
						var num = $(this).next().val();
						$(this).next().val(num*1-1);
						// console.log($(this).parent().parent().attr('data-index'));
						var price = $('.prices').eq(code).html();
						var sum = (num*1-1)*Number(price);
						var allprice = $('.allprice').eq(code).html(sum.toFixed(2));
						if($('.mycheckbox').eq(code).is(':checked')){
							var allps = $('.allps').html();
							var sum1 =  Number(allps)-Number(price);
							$('.allps').html(sum1.toFixed(2));
						}
					}
					var book = {};
					book.id = $(this).parent().parent().attr('data-index');
					book.num = $(this).next().val();
					book.allprice = sum;
					$.ajax({
						type:'get',
						url:'updategwc',
						data:'book='+JSON.stringify(book),
						dataType:'json',
						success:function(data){

						}
					})
					
				})
				
				//删除购物车内容
				$('.delgwc').on('click',function(){
					var id = $(this).attr('data-code');
					// console.log(id)
					var that = $(this);
					$('#exampleModalCenter').modal('show');
					$('.determine').click(function(){
						// console.log(111)
						$.ajax({
							type:'get',
							url:'/deletegwc',
							data:'id='+id,
							dataType:'json',
							success:function(data){
								if(data == 0){
									that.parent().parent().remove();
									$('#exampleModalCenter').modal('hide');
								}
							}
						})
					})
				})

				//结算
				$('.settlement').click(function(){
					var orders = {};
					var arr = [];
					if($('.mycheckbox').is(':checked')){
						// console.log(11);
						$('.mycheckbox').each(function(i){
							if($(this).is(':checked')){
								arr.push($(this).attr('data-id'))
							}
						})
						var total = $('.allps').html();
						var gwc_id = '';
						if(arr.length == 1){
							gwc_id = arr[0];
						}else{
							for(var i=0;i<arr.length;i++){
								gwc_id += arr[i];
								if(i < arr.length-1){
									gwc_id += ',';
								}
							}
						}
						// orders.user = $('#user_names').children().eq(0).text();
						orders.total = total;
						orders.gwc_id = gwc_id;
						// console.log(orders);
						$.ajax({
							type:'get',
							url:'/checkoutdata',
							data:'orders='+JSON.stringify(orders),
							dataType:'json',
							success:function(result){
								if(result == 1){
									window.location = '/checkout';
								}
							}
						})
					}
					return false;
				})
				
			})
			
		</script>
    </body>
</html>
